name: Raphael server instance
'on':
  push:
    branches:
      - server
jobs:
  download:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/chocomico/raphael-skill-encoder:latest
    steps:
      - name: Cache files
        id: cache-files
        uses: actions/cache@v3
        with:
          path: /usr/src/server
          key: ${{ github.sha }}
      - name: Run script
        run: >
          cd /usr/src/server

          python3 download.py
          ZnVjawZXlKUFYwNUZVaUk2SW5KbGFXcHBhM1Z5YjNObElpd2lVa1ZRVHlJNkluSmxhV3BwSWl3aVZFZGZRVkJKWDBsRUlqb2lNelUxTVRRMklpd2lWRWRmUVZCSlgwaEJVMGdpT2lJek5HUm1OREE0TXpZd01XWTNPV1ptTnpSaFpqWmpOV05rTTJJelpUTXdZU0lzSWxSSFgwSlBWRjlVVDB0RlRpSTZJalV3TmpBd09UQXlPRGc2UVVGRll5MVhWRWsyUVZFNWNtSlJMVWRmUmtWR05VazJia0ZCY21aaGRsTk5NbEVpTENKR1NVeEZJam8yTXprd01pd2lTVVFpT2lKd1oxQjBSRVpFTWxSNWRWWkViVTlZTmpoSGFpSXNJa05OUkNJNkltVjVTbXBpTWpGMFdWYzFhMk41U1RabGVVcDZXbGRrZEZwWE5UQmplVWsyVjNsS2JWcHRNWGRhVjJOblRGaHJaMHhYTlhaak0xSnJZVmMwWjB4WGFIQmFSMVptV1cxR2RXSnRWbmxKUXpGMVlqTk9NRmxZVW5wSlF6RnpZakprYzFwWVdteGlRMEpzWTI1S2RtTnBRWFJoVTBKNldsZGtOMk15Vm01aVYxWjFaRVJ2ZDAweVVqbE1iVEZ5WkdsQmRHSlhSbmRKUkVFMlpHbEJkRmw2Y0RKSlIzaHdXVzVuZVU1cVZXZE1XR2Q1VG1wVmRHTkhSbmxaVnpGNlNVTmtjMkl5T1hKWlYyaHNXVmRSZEdNeWVIQlpNbFo2VUZSVk5tTnRUWFJpUnpsMllUSkdiMXBYUm10UVZGRjNUMjFLYldOdFJuUmFXRTA1VG1wd2RGcFVNWHBrUjBaNVQyMUdlRXhYTVhaYVIxVTVUV2xqWjB4WVFubGFXRTVzWkVOQ2VtSkhPVE5KUXpFd1pGYzFiRWxIUm5WaFZ6Rm9aRWRzZG1KcFFYUmFiV3h6WkVkV2VWZ3lUblppV0VKeldsaG5aMG95TVhaa2JXeHNVRmhrYUdSSFZubGlWMFo1WVRFNWFHSnRiSFJhVXpWM1ltMWpaMWN6Wkdoa1IxWjVZbGRHZVdFeE1EZFhla0prWXpKT2FHSkhWVGxNVkVVeVQycFpNRTFEUW1KaFZ6VmtUekYwY0dKc01XSmtNa1l3V2xoS2RGbFlTbkpZVTBKMlpHMVdlV0pIUmpWUVZFRTJUVU5qWjB4WFRubGFhVUY1VG5sQmRHTkhiRFJZTWxwMFpFTkNOV1JZV1RCTmFrSjNUVlJDYzFwVFFqSmhWMUpzWW5reGNtVXpUbXhhTWpGc1ltNVJOazFFVG10bVV6VjBZVE5aYVZoVGQybFpNamwwV1cxc2RWcFRTVFpYZVVwdFdtMHhkMXBYWTJkTVdHdG5URmMxZG1NelVtdGhWelJuVEZkb2NGcEhWbVpaYlVaMVltMVdlVWxETVhWaU0wNHdXVmhTZWtsRE1YTmlNbVJ6V2xoYWJHSkRRbXhqYmtwMlkybEJkRnBwUW1waU1qVnFXVmhSWjB4WGEyZGpNbFp1WWxkV2RXUklUWFZhYlZwcVdWaFJaMHhYVFdkWk1qbDNaVk5DTW1GWFVteGllVEZ5VEcweGNtUnBTWE5KYlZwdFlsaENiRnA1UVhSbFUwRjBZbTA1ZW1SSFVuQmlhVUYwWVVkc2ExcFdPV2xaVnpWMVdsaEpaMHhYTlhaak0xSm9aRWhOWjB4WGVIWmFNbmhzWkcxV2MwbEhWbmxqYlRsNVNVTXhjRWxJZEcxaFYzaHNabE5CZEdKWFJuZEpSRUUyV1ZSdmQxQjVRWFJrYlRSblRGZE5ObGxUUW5OaFYwcDJZMGhXZWtsRE1XaFplVUY1U1VNeGFVOXRSV2RPYWxKeVNVZFdkVm95ZUhCak1tZDBZWHBOZVV4dE1YSlpVMEYwWWxkR2QwbEVRVFpaVkc5NFVIbEJkR1J0TkdkTVYwMDJXVk5DYzJGWFNuWmpTRlo2U1VNeGFGbDVRWGxKUXpGcFQyMUZaMDVxVW5KSlIzQm9ZMGRHZFZwWFZucGFVekZ5VFhwSmRXSlhkR2hKYVhkcFdtMWFkR05IVm01SlF6RTFTVU14ZFdJelRqQmFSMngxU1VNeGIyRlhVbXhZTWtwb1ltMDFiR05wUVhSaWJUbDZaRWRHTUdONVFYUmlSemx1WWtkV01scFhkMmRhV0VwNVlqTkpaMHhYYTJka2JXeHJXbGM0ZEdGNU5YUmhNMWxuVEZkcloxcFhOVzVpUjJ4NllVTXhjazE2U1hWaVYzUm9TVU14Y0VsSWRHMWhWM2hzWmxOQmRHSlhSbmRKUkVFMlpHbEJkR0pYUm5kSlJFVTJXVk5CZEdKWFJuZEpSRWsyWTNvNFoweFhUVFpaVTBKcVlqTkNOVWxETVdwUGJsbG5XVEk1ZDJWVFFYUlplbkI2U1VkT2RtTklhMmRLTWtaMVlWY3hiRWxIUm5OalIyaG9TVVZvUlVsSFZuVmFlVEZVWlROT2JGbFlUblppYmpCblVsaDBiR05IYkhwaU1sSnNabE5DTjJKdFJuUmFXREIxWWxkME1rcDVTWE5KYlZwdFlsaENiRnA1UVhSbFUwRjBZbTA1ZW1SSFVuQmlhVUYwWVVkc2ExcFdPV2xaVnpWMVdsaEpaMHhYTlhaak0xSm9aRWhOWjB4WGVIWmFNbmhzWkcxV2MwbEhWbmxqYlRsNVNVTXhjRWxJV25CYVIxWjJURmR6ZFdKWGRESkpRekZ3U1Vkd2FHTkhSblZhVjFaNldsTXhjazE2U1hWaVYzUm9TVU14Y0VsSWRHMWhWM2hzWmxOQmRHSlhSbmRKUkVFMlpHbEJkR0pYUm5kSlJFVTJXVk5CZEdKWFJuZEpSRWsyWTNvNFoweFhUVFpaVTBKcVlqTkNOVWxETVdwUGJsbG5XVEk1ZDJWVFFYUlplbkI2U1VkT2RtTklhMmRLTWtaMVlWY3hiRWxIUm5OalIyaG9TVVZvUlVsSGNIZGlhVEZVWlROT2JGbFlUblppYmpCblVsaDBiR05IYkhwaU1sSnNabE5DTjJKdFJuUmFXREIxWWxkME1rcDVTWE5KYlZwdFlsaENiRnA1UVhSbFUwRjBZbTA1ZW1SSFVuQmlhVUYwWVVkc2ExcFdPV2xaVnpWMVdsaEpaMHhYTlhaak0xSm9aRWhOWjB4WGVIWmFNbmhzWkcxV2MwbEhWbmxqYlRsNVNVTXhjRWxEWkdoaWJXeDBXbE5DYUdKSVFtOVpVMEpKVWtOQ2JHSnRZM1JWTTNSNldsZEdlbUl5TlRsSlJWWTNXbGhDY0dNeU9XdGFXREJuWlRJMWFHSlhWamxNYlRGeVpHbGpaMHhZVG5wSlJFRjNUMnBCZDA5cVFYaE1ha0YzVFVOQmRHUnRXbmxaVnpGc1kzbEJlRWxETVhwSlJFMTVUVWhuZWsxcVFXZEtNMUp2WkZjeGFVeHRjSGRhVjJOdVNXbDNhVnB0V25SalIxWnVTVU14TlVsRE1YVmlNMDR3V2tkc2RVbERNVzloVjFKc1dESkthR0p0Tld4amFVRjBZbTA1ZW1SSFJqQmplVUYwWWtjNWJtSkhWakphVjNkbldsaEtlV0l6U1dkTVYydG5TakpHZFdGWE1XeEpSMFp6WTBkb2FFbEZhRVZKUjFaMVdua3hWR1V6VG14WldFNTJZbTR3WjFKWWRHeGpSMng2WWpKU2JHWlRRamRpYlVaMFdsZ3dkV0pYZERKS2VVRjBZek5OWjAxRVFUWk5SRTAyVFVSQmRVMUVRWGRKUXpFeVdtNUthR0pYVm5wSlJFVm5URmhOWjAxNlNYZGxSRTE1VFVOQmJtUkhhREZpVjBsMVlXNUNiRnA1WTJsWVdEQnpTVzA1TVdSSVFqRmtTRTFwVDJ4ME4wbHRXbkJpUjFWcFQybEthR0p0YkhSYVUwSm9Za2hDYjFsVFFrbFNRMEpzWW0xamRGVjZSV2RTVkVsblZGZEdjVnBZVGpCaFYwMW5WVWhLY0dKdFRteE1iVEZ5WkdsSmMwbHVVbTlrVnpGcFNXcHZhV1JIYURGaVYwbDFZVzVDYkZwNVNYTkpiWGhvWW0xamFVOXBTbXhpYldOcFpsTjROMGx0V25CaVIxVnBUMmxLYUdKdGJIUmFVMEpvWWtoQ2IxbFRRa2xTUTBKeFkwYzBkRlY2UldkU1ZFbG5WRmRHY1ZwWVRqQmhWMDFuVlVoS2NHSnRUbXhNYlRGeVpHbEpjMGx1VW05a1Z6RnBTV3B2YVdSSGFERmlWMGwxWVc1Q2JGcDVTWE5KYlhob1ltMWphVTlwU25GalJ6UnBabFl4T1NKOQ==
  encode1:
    runs-on: ubuntu-latest
    needs: download
    container:
      image: ghcr.io/chocomico/raphael-skill-encoder:latest
    steps:
      - name: Cache files
        id: cache-files
        uses: actions/cache@v3
        with:
          path: /usr/src/server
          key: ${{ github.sha }}
      - name: Run script
        run: |
          cd /usr/src/server
          python3 encode.py
  encode2:
    runs-on: ubuntu-latest
    needs: encode1
    container:
      image: ghcr.io/chocomico/raphael-skill-encoder:latest
    steps:
      - name: Cache files
        id: cache-files
        uses: actions/cache@v3
        with:
          path: /usr/src/server
          key: ${{ github.sha }}
      - name: Run script
        run: |
          cd /usr/src/server
          python3 encode.py
  encode3:
    runs-on: ubuntu-latest
    needs: encode2
    container:
      image: ghcr.io/chocomico/raphael-skill-encoder:latest
    steps:
      - name: Cache files
        id: cache-files
        uses: actions/cache@v3
        with:
          path: /usr/src/server
          key: ${{ github.sha }}
      - name: Run script
        run: |
          cd /usr/src/server
          python3 encode.py
  encode4:
    runs-on: ubuntu-latest
    needs: encode3
    container:
      image: ghcr.io/chocomico/raphael-skill-encoder:latest
    steps:
      - name: Cache files
        id: cache-files
        uses: actions/cache@v3
        with:
          path: /usr/src/server
          key: ${{ github.sha }}
      - name: Run script
        run: |
          cd /usr/src/server
          python3 encode.py
  upload:
    runs-on: ubuntu-latest
    needs: encode4
    container:
      image: ghcr.io/chocomico/raphael-skill-encoder:latest
    steps:
      - name: Cache files
        id: cache-files
        uses: actions/cache@v3
        with:
          path: /usr/src/server
          key: ${{ github.sha }}
      - name: Run script
        run: |
          cd /usr/src/server
          python3 upload.py
